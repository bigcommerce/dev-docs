# Big Open Data Layer for Storefront Analytics

The Big Open Data Layer (shortened as _BODL_, pronounced 'Bottle') is a JavaScript object that simplifies sending data from BigCommerce-hosted storefronts to third-party analytics providers. It gives third-party scripts access to clean, consistent data. BODL makes store sites more efficient by consolidating data of interest and presenting it as a package. Each analytics script does not need to fetch the same data independently. 

BODL is event-based. Scripts can capture accurate storefront data as it exists at the moment a shopper triggers any BODL-supported event.

This guide illustrates the basics of using BODL data in your integration. This article does the following: 
1. Describes the standard BODL schema after a shopper triggers a specified event so that you can see how BODL organizes event data for your integration to capture. 
2. Provides an example script that uses the standard BODL object so you can examine BODL properties in the browser console. 
3. Gives an example of adding a BODL script to a storefront page using the Scripts API.

## Prerequisites

For scripts to successfully use BODL to access storefront data, the following must be true:
- The merchant must enable BODL on the subject storefront in the control panel
- The storefront must use a stencil theme
- If a merchant enables cookie tracking consent on the subject storefront, the shopper must consent to the [appropriate category](#category-of-consent)

## BODL event schemas

BODL exposes data when shoppers trigger storefront events. Currently, BODL supports the following storefront events:

- [View product page](#view-product-page-event-schema)
- [View product category](#view-product-category-event-schema)
- [Add product to cart](#add-product-to-cart-event-schema)
- [View cart](#view-cart-event-schema)
- [Remove product from cart](#remove-product-from-cart-event-schema)
- [Start checkout](#start-checkout-event-schema)
- [Purchase order](#purchase-order-event-schema)

### View product page

When the shopper clicks a button to view a product page, the following fields appear in the BODL object for the item:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `channel_id` | integer | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Item on the product page. | See [line_item](#line_item-object-schema) object for event fields |

### View product category

When the shopper clicks a button to view the category page for a product, the following fields appear in the BODL object for the item:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `category_id` | integer | ID of the category. | [Get all categories](/docs/rest-management/catalog/category#get-all-categories) <br /> `data.id` |
| `category_name` | string | Name of the category. | [Get all categories](/docs/rest-management/catalog/category#get-all-categories) <br /> `data.name` |
| `channel_id` | integer | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Items in the category. | See [line_item](#line_item-object-schema) object for event fields |

### Add product to cart

When the shopper clicks a button to add a product to a cart, the following fields appear in the BODL object for the item:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `channel_id` | string | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br />  `data.cart.currency.code` |
| `id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Items added to the cart. | See [line_item](#line_item-object-schema) object for event fields |
| `product_value` | number | Item price before discounts and coupons. Product default price or, if applicable, the sale price configured in the admin panel. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `lineItems.physicalItems.listPrice` or <br /> `lineItems.digitalItems.listPrice`|

### View cart

When the shopper clicks a button to view a cart, the following fields appear in the BODL object for the item:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `cartAmount` |
| `channel_id` | string | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br />  `data.cart.currency.code` |
| `id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | All items in the cart. | See [line_item](#line_item-object-schema) object for event fields |

### Remove product from cart

When the shopper clicks a button to remove a product from the cart, the following fields appear in the BODL object for the item:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `cartAmount` |
| `channel_id` | string | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br />  `data.cart.currency.code` |
| `line_items[]` | array of `line_item` objects | Items removed from the cart. | See [line_item](#line_item-object-schema) object for event fields |

### Start checkout

When the shopper clicks on the button to initiate a checkout process, the following fields appear in the BODL object for the item:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `cartAmount` |
| `channel_id` | string | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `coupon_codes[]` | array of strings | Coupon codes applied to the cart. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `coupons.code` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. BigCommerce tracks currency for a cart and not for each line item within the cart. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `currency.code` |
| `event_id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Items that were checked out. | See [line_item](#line_item-object-schema) object for event fields |

### Purchase order

When the shopper clicks a button to finalize a purchase, the following fields appear in the BODL object for the event:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a checkout](/docs/rest-management/checkouts#get-a-checkout) <br /> `data.cart.cart_amount_inc_tax` |
| `channel_id` | integer | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/docs/rest-management/channels#get-all-channels) <br /> `data.id` |
| `coupon_codes[]` | array of strings | Coupon codes applied to the purchase. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br /> `data.cart.coupons.code` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br />  `data.cart.currency.code` |
| `event_id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Items that were purchased. | See [line_item](#line_item-object-schema) object for event fields |
| `order_id` | integer | Unique transaction ID generated by BigCommerce to prevent duplicate purchase records. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br /> `data.orderId` |
| `shipping_cost` | number | Total shipping cost including tax. | [Get a checkout](/docs/rest-management/checkouts#get-a-checkout) <br /> `data.shipping_cost_total_inc_tax` |
| `tax` | number | Tax incurred. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br /> `data.taxTotal` |

### line_item object schema

The `line_item` object has many common fields for browser events, including the following fields:   

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `base_price` | number | Price of product. Default price in the control panel. The price should include or exclude tax, based on the store settings. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.price` |
| `brand_name` | string | Brand name. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.brand_name` |
| `category_names[]` | array of strings | Category names. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.categories[]` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) for the transaction. | [Get a checkout](/docs/rest-management/checkouts#get-a-checkout) <br />  `data.cart.currency.code`  |
| `discount` | number | Discount applied to the item. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br /> `data.cart.discountAmount` |
| <sup>+</sup>`gift_certificate_id` | string | ID of gift certificate. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `lineItems.giftCertificates.id` |
| <sup>+</sup>`gift_certificate_name` | string | Name of gift certificate that appears in the control panel. | [Get a Cart](/docs/rest-storefront/carts#get-a-cart) <br /> `lineItems.giftCertificates.name` |
| <sup>+</sup>`gift_certificate_theme` | string | Theme of gift certificate. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `lineItems.giftCertificates.theme` |
| <sup>+</sup>`index` | integer | The position of the item in the cart. | [Get a checkout](/docs/rest-storefront/checkouts#get-a-checkout) <br /> `data.cart.lineItems.physicalItems.id` or `data.cart.lineItems.digitalItems.id` |
| `product_id` | integer | ID of the product. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.id` |
| `product_name` | string | Name of the product. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.name` |
| `purchase_price` | number | Final price of product that the shopper actually pays before taxes and other charges. Equals the `base_price` unless there is a `sale_price`. The price should include or exclude tax, based on the store settings. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.price` or <br /> `data.sale_price` |
| `quantity` | integer | Number of items of product purchased. | [Get a cart](/docs/rest-storefront/carts#get-a-cart) <br /> `lineItems.physicalItems.quantity` or <br /> `lineItems.digitalItems.quantity` |
| <sup>++</sup>`retail_price` | number | The retail price of the product. The price should include or exclude tax, based on the store settings. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.retail_price` |
| `sale_price` | number | Price of product after sale. The price should include or exclude tax, based on the store settings. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.sale_price` |
| `sku` | string | User-defined SKU for the product or variant (whichever is applied). | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.sku` or `data.variants.sku` |
| <sup>+++</sup>`variant_id` | integer | ID of the variant. | [Get a product](/docs/rest-management/catalog/products#get-a-product) <br /> `data.variants.id` | 

<sup>+</sup> Included in View product page, View product category, View cart events <br />
<sup>++</sup> Included in View product page, View product category, Add product to cart, View cart, Remove product from cart events <br />
<sup>+++</sup> Included in View product page, View product category, View cart, Start checkout, Purchase order events

## Example implementation

You can use the [Scripts API](/docs/rest-management/scripts) or control panel [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager) to add scripts to a BigCommerce-hosted storefront.

Merchants must enable BODL in the store control panel for your script to subscribe to BODL events. Once BODL is enabled, BigCommerce checks every storefront page for the BODL object once per page render. 

### Example script

To view BODL properties in the browser console, use the following example script:

```html filename="Log BODL to the browser console" showLineNumbers copy
<script>

function subscribeOnBodlEvents() {
  // log to verify that the function is executing
  console.log('run subscribeOnBodlEvents()');

  if (
    // window is falsy
    !window ||
    // window.bodlEvents is not defined
    typeof window.bodlEvents === 'undefined' ||
    // window.bodlEvents.checkout is not defined
    typeof window.bodlEvents.checkout === 'undefined' ||
    // window.bodlEvents.cart is not defined
    typeof window.bodlEvents.cart === 'undefined' ||
    // window.bodlEvents.product is not defined
    typeof window.bodlEvents.product === 'undefined' 
  ) {
    // log 'not defined' to the console
    console.log('not defined');
    // and end script execution
    return;
  }

  // if window.dataLayer doesn't exist, make it an empty array
  window.dataLayer = window.dataLayer || [];
    
  // If window.bodlEvents.product.pageViewed is available, then...
  if (typeof window.bodlEvents.product.pageViewed === 'function') {
    // run the pageViewed function to get the payload
    window.bodlEvents.product.pageViewed((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.product.pageViewed ~ payload',
        payload
      );
    });
  }
    
  // If window.bodlEvents.product.categoryViewed is available, then...
  if (typeof window.bodlEvents.product.categoryViewed === 'function') {
    // run the categoryViewed function to get the payload
    window.bodlEvents.product.categoryViewed((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.product.categoryViewed ~ payload',
        payload
      );
    });
  }
    
  // If window.bodlEvents.cart.addItem is available, then...
  if (typeof window.bodlEvents.cart.addItem === 'function') {
    // run the addItem function to get the payload
    window.bodlEvents.cart.addItem((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.cart.addItem ~ payload',
        payload
      );
    });
  }
    
  // If window.bodlEvents.cart.viewed is available, then...
  if (typeof window.bodlEvents.cart.viewed === 'function') {
    // run the viewed function to get the payload
    window.bodlEvents.cart.viewed((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.cart.viewed ~ payload',
        payload
      );
    });
  }
    
  // If window.bodlEvents.cart.removeItem is available, then...
  if (typeof window.bodlEvents.cart.removeItem === 'function') {
    // run the removeItem function to get the payload
    window.bodlEvents.cart.removeItem((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.cart.removeItem ~ payload',
        payload
      );
    });
  }
    
  //   If window.bodlEvents.checkout.checkoutBegin is available, then...
  if (typeof window.bodlEvents.checkout.checkoutBegin === 'function') {
    // run the checkoutBegin function to get the payload
    window.bodlEvents.checkout.checkoutBegin((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.checkout.checkoutBegin ~ payload',
        payload
      );
    });    
  }

  // If window.bodlEvents.checkout.orderPurchased is available, then...
  if (typeof window.bodlEvents.checkout.orderPurchased === 'function') {
    // run the orderPurchase function to get the payload
    window.bodlEvents.checkout.orderPurchased((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.checkout.orderPurchased ~ payload',
        payload
      );
    });
  }
}

// when the page window loads, run the subscribeOnBodlEvents function
window.addEventListener('load', subscribeOnBodlEvents, false);

</script>
```

<Callout type="info">
#### Category of consent
If a merchant enables cookie tracking consent, the shopper must provide consent to the category of consent (`consent_category`) to which the script is set. For more on consent categories, see the [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager) support article.
</Callout>

### Scripts API example

The following is an example request that uses the Scripts API to inject the example script. Send a request to the [Create a script](/docs/rest-management/scripts#create-a-script) endpoint. For more, see the [Scripts API article](/api-docs/store-management/scripts).

```json filename="Example request: Create a Script" showLineNumbers copy
POST https://api.bigcommerce.com/stores/{{STORE_HASH}}/v3/content/scripts
X-Auth-Token: {{ACCESS_TOKEN}}     //scope should include Checkout Content when adding script to a checkout page
Content-Type: application/json
Accept: application/json

{
  "name": "BODL script",
  "description": "view BODL in the browser console",
  "html": "<script> function subscribeOnBodlEvents() {console.log('run subscribeOnBodlEvents()'); window.dataLayer = window.dataLayer || []; if (!window || typeof window.bodlEvents === 'undefined' || typeof window.bodlEvents.checkout === 'undefined') {console.log('not defined'); return;} if (typeof window.bodlEvents.checkout.checkoutBegin === 'function') {window.bodlEvents.checkout.checkoutBegin((payload) => {console.log('window.bodlEvents.checkout.checkoutBegin ~ payload', payload);});} if (typeof window.bodlEvents.checkout.orderPurchased === 'function') {window.bodlEvents.checkout.orderPurchased((payload) => {console.log('window.bodlEvents.checkout.orderPurchased ~ payload', payload);});}}  window.addEventListener('load', subscribeOnBodlEvents, false); </script>",
  "load_method": "default",
  "location": "head",
  "visibility": "all_pages",            //set which pages BODL appears
  "kind": "script_tag",
  "consent_category": "essential",      //script is set to a category of consent
  "enabled": true,
  "channel_id": 2                       //storefront channel ID
}
```

## Resources
- [Scripts API article](/api-docs/store-management/scripts).
- [Scripts API reference](/docs/rest-management/scripts#create-a-script)
- [Scripts Manager support article](https://support.bigcommerce.com/s/article/Using-Script-Manager)
