# Big Open Data Layer for Storefront Analytics

The Big Open Data Layer (shortened as BODL, pronounced 'Bottle') is a JavaScript object that allows you to transport data from a Bigcommerce-hosted storefront to third-party analytic providers. This data layer exposes storefront data points to BigCommerce and third-party analytics integrations. Using BODL on a BigCommerce-hosted storefront ensures that analytics providers have access to consistent, clean page data and makes a site more efficient. Because BODL consolidates data of interest and presents it as a package, each analytics script does not need to independently fetch the same data.

BODL currently transports data for storefront events that are triggered by a shopper. BigCommerce checks your storefront for a BODL instance once per page render. To ensure that the analytics providers you've chosen have the complete and correct set of data points they require, a merchant must enable BODL through the store control panel so that each storefront page window subscribes to BODL events. As a developer, you can then access storefront data after a shopper triggers a BODL event. 

This guide shows you how to get started using BODL data in your integration. The first section describes the standard BODL schema after shopper triggers a specified event, so that you can see how BODL organizes information for your integration to capture. The remainder provides example scripts for using the standard BODL object, displaying BODL parameters into the browser console or supplying data to third-party analytics engines. You can inject JavaScript snippets into a BigCommerce-hosted storefront using the [Scripts API](/api-reference/store-management/scripts) or the [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager).

## Standard BODL schema

BODL transports data after shoppers trigger storefront events. The following are supported storefront events:
- Start checkout
- Purchase order 

### BODL schema after start checkout event

When the shopper clicks on the button to initiate a checkout process, the following fields appear in the BODL object:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `event_id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. Not needed for GA4. |
| `channel_id` | string | The BigCommerce channel ID. | Channel ID of the channel where checkout is taking place. Not needed for GA4. |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order.  BC tracks currency for a cart and not for each line item within the cart. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `currency.code` |
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `cart_amount` |
| `coupon_codes[]` | array of strings | Coupon codes applied to the cart. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `coupons.code` |
| `line_items[]` | array of `line_item` objects | Items being checked out. | See [line_item](#common-event-fields-line_item-object) object for event fields |

### BODL schema after purchase order event

When the shopper clicks a button to finalize a purchase, the following fields appear in the BODL object:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `event_id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. Not needed for GA4. |
| `channel_id` | string | The BigCommerce channel ID. | Channel ID of the channel where checkout is taking place. Not needed for GA4. |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br>  `data.cart.currency.code` |
| `order_id` | string | Unique transaction ID generated by BigCommerce to prevent duplicate purchase records. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.order_id` |
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.cart.cart_amount_inc_tax` | 
| `coupon_codes[]` | array of strings | Coupon codes applied to the purchase. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.cart.coupons[].code` |
| `shipping_cost` | number | Total shipping cost including tax. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.shipping_cost_total_inc_tax` |
| `tax` | number | Tax incurred. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.tax_total` |
| `line_items[]` | array of `line_item` objects | Items being purchased. | See [line_item](#common-event-fields-line_item-object) object for event fields |

### Common event fields: line_item object

The `line_item` object has many common fields for browser events. The `line_item` object includes the following fields:   

| Web browser event fields | Type | Description | BigC data map |
| - | - | - | - |
| `product_id` | string | ID of the product. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.id` |
| `product_name` | string | Name of the product. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.name` |
| `sku` | string | User-defined SKU for the product or variant (whichever is applied). | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.sku` or `data.variants.sku` |
| `base_price` | number | Price of product. Default price in the control panel. The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.price` |
| `sale_price` | number | Price of product after sale. The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.sale_price` |
| `retail_price` | number | Maximum suggested retail price (MSRP). The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.retail_price` |
| `purchase_price` | number | Final price of product that the shopper actually pays before taxes and other charges. Equals the `base_price` unless there is a `sale_price`. The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.price` or <br> `data.sale_price` |
| `quantity` | number | Number of items of product purchased. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `data.line_items.physical_items.quantity` or <br> `data.line_items.digital_items.quantity` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) for the transaction. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br>  `data.cart.currency.code`  |
| `discount` | number | Discount applied to purchase. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.cart.discount_amount` |
| `index` | integer | Position of item in a list. | - |
| `brand_name` | string | Brand name. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.brand_name` |
| `category_names[]` | array | Category names. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.categories[]` |

## Using BODL 

You can inject JavaScript snippets into a BigCommerce-hosted storefront using the [Scripts API](/api-reference/store-management/scripts) or the [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager).

### Display BODL parameters in the browser console 

```js
<script>

function subscribeOnBodlEvents() {
  // logs function name to console to verify that the function is called on every page load
  console.log('run subscribeOnBodlEvents()');

  // lets window.dataLayer also be an empty array
  window.dataLayer = window.dataLayer || [];

  // If...
  if (
    // window is not defined, or
    !window ||
    // window.bodlEvents is not defined, or
    typeof window.bodlEvents === 'undefined' ||
    // window.bodlEvents.checkout is not defined
    typeof window.bodlEvents.checkout === 'undefined'
  ) {
    // then log 'not defined' to the console
    console.log('not defined');
    // and end script execution
    return;
  }

  //   If window.bodlEvents.checkout.checkoutBegin is available, then...
  if (typeof window.bodlEvents.checkout.checkoutBegin === 'function') {
    // run the checkoutBegin function to get the payload
    window.bodlEvents.checkout.checkoutBegin((payload) => {
      // take the payload and log it to the console
      console.log(
        'window.bodlEvents.checkout.orderPurchased ~ payload',
        payload
      );
    });    
  }

  // If window.bodlEvents.checkout.orderPurchased is available, then...
  if (typeof window.bodlEvents.checkout.orderPurchased === 'function') {
    // run the orderPurchase function to get the payload
    window.bodlEvents.checkout.orderPurchased((payload) => {
      // take the payload and log it to the console
      console.log(
        'window.bodlEvents.checkout.orderPurchased ~ payload',
        payload
      );
    });
  }
}

// wait for window load event to run the subscribeOnBodlEvents function
window.addEventListener('load', subscribeOnBodlEvents, false);

</script>
```

The following is an example request that uses the Scripts API to inject the script. Send a request to the [Create a script](/api-reference/store-management/scripts/scripts/createscript) endpoint.

```json title="Example request: Create a Script" lineNumbers
POST https://api.bigcommerce.com/stores/{{STORE_HASH}}/v3/content/scripts
X-Auth-Token: {{ACCESS_TOKEN}}
Content-Type: application/json
Accept: application/json

{
  "name": "BODL script",
  "description": "view BODL in the browser console",
  "html": "<script> function subscribeOnBodlEvents() {console.log('run subscribeOnBodlEvents()'); window.dataLayer = window.dataLayer || []; if (!window || typeof window.bodlEvents === 'undefined' || typeof window.bodlEvents.checkout === 'undefined') {console.log('not defined'); return;} if (typeof window.bodlEvents.checkout.checkoutBegin === 'function') {window.bodlEvents.checkout.checkoutBegin((payload) => {console.log('window.bodlEvents.checkout.orderPurchased ~ payload', payload);});} if (typeof window.bodlEvents.checkout.orderPurchased === 'function') {window.bodlEvents.checkout.orderPurchased((payload) => {console.log(   'window.bodlEvents.checkout.orderPurchased ~ payload', payload);});}}  window.addEventListener('load', subscribeOnBodlEvents, false); </script>",
  "load_method": "default",
  "location": "head",
  "visibility": "all_pages",
  "kind": "script_tag",
  "consent_category": "essential",
  "enabled": true,
  "channel_id": 2
}
```

<!--theme: info -->
> #### Category of consent
> If a merchant enables cookie consent tracking, the shopper must provide consent to the category of consent (`consent_category`) to which the script is set. For more on consent category, see the [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager) support article.


### Transport data to a third-party analytic provier 

The following is an example of how to supply data from BODL to a third-party analytic provider (GA4). This script is an example usage of BODL, as methods and syntax vary between analytics engine providers. 

## Resources