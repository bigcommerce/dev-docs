# Big Open Data Layer for Storefront Analytics

The Big Open Data Layer (shortened as _BODL_, pronounced 'Bottle') is a JavaScript object that simplifies sending data from BigCommerce-hosted storefronts to third-party analytics providers. It gives third-party scripts access to clean, consistent data. BODL makes store sites more efficient by consolidating data of interest and presenting it as a package. Each analytics script does not need to fetch the same data independently. 

BODL is event-based. Scripts can capture accurate storefront data as it exists at the moment a shopper triggers any BODL-supported event.

This guide illustrates the basics of using BODL data in your integration. First, it describes the standard BODL schema after a shopper triggers a specified event, so that you can see how BODL organizes event data for your integration to capture. Next, it provides an example script that uses the standard BODL object to examine BODL properties in the browser console. Finally, it gives an example of adding a BODL script to a storefront page using the Scripts API.

## Prerequisites

For scripts to successfully use BODL to access storefront data, the following must be true:
- Enable BODL on the subject storefront using the control panel or the [Datalayer API](/api-docs/store-management/data-layer-api)
- The storefront must use a stencil theme
- If a merchant enables cookie tracking consent on the subject storefront, the shopper must consent to the [appropriate category](#category-of-consent)

## BODL event schemas

BODL exposes data when shoppers trigger storefront events. Currently, BODL supports the following storefront events:
- Start checkout
- Purchase order 

### Start checkout event schema

When the shopper clicks on the button to initiate a checkout process, the following fields appear in the BODL object:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `cart_amount` |
| `channel_id` | string | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/api-reference/store-management/channels/channels/listchannels) <br> `data.id` |
| `coupon_codes[]` | array of strings | Coupon codes applied to the cart. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `coupons.code` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. BigCommerce tracks currency for a cart and not for each line item within the cart. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `currency.code` |
| `event_id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Items being checked out. | See [line_item](#line_item-object-schema) object for event fields |

### Purchase order event schema

When the shopper clicks a button to finalize a purchase, the following fields appear in the BODL object:

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `cart_value` | number | Final value of cart after taxes, discounts, and coupons are applied. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.cart.cart_amount_inc_tax` |
| `channel_id` | string | The BigCommerce channel ID. Channel ID of the channel where checkout is taking place. | [Get all channels](/api-reference/store-management/channels/channels/listchannels) <br> `data.id` |
| `coupon_codes[]` | array of strings | Coupon codes applied to the purchase. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.cart.coupons[].code` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) of the order. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br>  `data.cart.currency.code` |
| `event_id` | string | Unique ID for each event instance. | Unique event ID generated by BigCommerce. |
| `line_items[]` | array of `line_item` objects | Items being purchased. | See [line_item](#line_item-object-schema) object for event fields |
| `order_id` | string | Unique transaction ID generated by BigCommerce to prevent duplicate purchase records. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.order_id` |
| `shipping_cost` | number | Total shipping cost including tax. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.shipping_cost_total_inc_tax` |
| `tax` | number | Tax incurred. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.tax_total` |

### line_item object schema

The `line_item` object has many common fields for browser events, including the following fields:   

| Event field | Type | Description | BigC data map |
|:---|:---|:---|:---|
| `base_price` | number | Price of product. Default price in the control panel. The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.price` |
| `brand_name` | string | Brand name. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.brand_name` |
| `category_names[]` | array | Category names. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.categories[]` |
| `currency` | string | [ISO-4217 currency code](https://en.wikipedia.org/wiki/ISO_4217) for the transaction. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br>  `data.cart.currency.code`  |
| `discount` | number | Discount applied to purchase. | [Get a checkout](/api-reference/store-management/checkouts/checkout/checkoutsbycheckoutidget) <br> `data.cart.discount_amount` |
| `product_id` | string | ID of the product. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.id` |
| `product_name` | string | Name of the product. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.name` |
| `purchase_price` | number | Final price of product that the shopper actually pays before taxes and other charges. Equals the `base_price` unless there is a `sale_price`. The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.price` or <br> `data.sale_price` |
| `quantity` | number | Number of items of product purchased. | [Get a cart](/api-reference/store-management/carts/cart/getacart) <br> `data.line_items.physical_items.quantity` or <br> `data.line_items.digital_items.quantity` |
| `sale_price` | number | Price of product after sale. The price should include or exclude tax, based on the store settings. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.sale_price` |
| `sku` | string | User-defined SKU for the product or variant (whichever is applied). | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.sku` or `data.variants.sku` |
| `variant_id` | integer | ID of the variant. | [Get a product](/api-reference/store-management/catalog/products/getproductbyid) <br> `data.variants.id` | 


## Example implementation

You can use the [Scripts API](/api-reference/store-management/scripts) or control panel [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager) to add scripts to a BigCommerce-hosted storefront.

Merchants must enable BODL in the store control panel for your script to subscribe to BODL events. Once BODL is enabled, BigCommerce checks every storefront page for the BODL object once per page render. 

### Example script

To view BODL properties in the browser console, use the following example script:

```html title="Log BODL to the browser console" lineNumbers
<script>

function subscribeOnBodlEvents() {
  // log to verify that the function is executing
  console.log('run subscribeOnBodlEvents()');

  if (
    // window is falsy
    !window ||
    // window.bodlEvents is not defined
    typeof window.bodlEvents === 'undefined' ||
    // window.bodlEvents.checkout is not defined
    typeof window.bodlEvents.checkout === 'undefined'
  ) {
    // log 'not defined' to the console
    console.log('not defined');
    // and end script execution
    return;
  }

  // if window.dataLayer doesn't exist, make it an empty array
  window.dataLayer = window.dataLayer || [];

  //   If window.bodlEvents.checkout.checkoutBegin is available, then...
  if (typeof window.bodlEvents.checkout.checkoutBegin === 'function') {
    // run the checkoutBegin function to get the payload
    window.bodlEvents.checkout.checkoutBegin((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.checkout.checkoutBegin ~ payload',
        payload
      );
    });    
  }

  // If window.bodlEvents.checkout.orderPurchased is available, then...
  if (typeof window.bodlEvents.checkout.orderPurchased === 'function') {
    // run the orderPurchase function to get the payload
    window.bodlEvents.checkout.orderPurchased((payload) => {
      // log the event payload
      console.log(
        'window.bodlEvents.checkout.orderPurchased ~ payload',
        payload
      );
    });
  }
}

// when the page window loads, run the subscribeOnBodlEvents function
window.addEventListener('load', subscribeOnBodlEvents, false);

</script>
```

<!--theme: info -->
> #### Category of consent
> If a merchant enables cookie tracking consent, the shopper must provide consent to the category of consent (`consent_category`) to which the script is set. For more on consent categories, see the [Script Manager](https://support.bigcommerce.com/s/article/Using-Script-Manager) support article.

### Scripts API example

The following is an example request that uses the Scripts API to inject the example script. Send a request to the [Create a script](/api-reference/store-management/scripts/scripts/createscript) endpoint. For more, see the [Scripts API article](/api-docs/store-management/scripts).

```json title="Example request: Create a Script" lineNumbers
POST https://api.bigcommerce.com/stores/{{STORE_HASH}}/v3/content/scripts
X-Auth-Token: {{ACCESS_TOKEN}}     //scope should include Checkout Content when adding script to a checkout page
Content-Type: application/json
Accept: application/json

{
  "name": "BODL script",
  "description": "view BODL in the browser console",
  "html": "<script> function subscribeOnBodlEvents() {console.log('run subscribeOnBodlEvents()'); window.dataLayer = window.dataLayer || []; if (!window || typeof window.bodlEvents === 'undefined' || typeof window.bodlEvents.checkout === 'undefined') {console.log('not defined'); return;} if (typeof window.bodlEvents.checkout.checkoutBegin === 'function') {window.bodlEvents.checkout.checkoutBegin((payload) => {console.log('window.bodlEvents.checkout.checkoutBegin ~ payload', payload);});} if (typeof window.bodlEvents.checkout.orderPurchased === 'function') {window.bodlEvents.checkout.orderPurchased((payload) => {console.log('window.bodlEvents.checkout.orderPurchased ~ payload', payload);});}}  window.addEventListener('load', subscribeOnBodlEvents, false); </script>",
  "load_method": "default",
  "location": "head",
  "visibility": "all_pages",            //set which pages BODL appears
  "kind": "script_tag",
  "consent_category": "essential",      //script is set to a category of consent
  "enabled": true,
  "channel_id": 2                       //storefront channel ID
}
```

## Resources
- [Scripts API article](/api-docs/store-management/scripts).
- [Scripts API reference](/api-reference/store-management/scripts)
- [Scripts Manager support article](https://support.bigcommerce.com/s/article/Using-Script-Manager)
